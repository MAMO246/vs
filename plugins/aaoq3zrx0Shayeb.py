#TeleGram: @ADIL721
import base64
exec(base64.b64decode('IyEvdXNyL2Jpbi9lbnYgcHl0aG9uMwojIENvcHlyaWdodCAoQykgQHN1YmlucHMKIyBUaGlzIHByb2dyYW0gaXMgZnJlZSBzb2Z0d2FyZTogeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeQojIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEFmZmVybyBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieQojIHRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb24sIGVpdGhlciB2ZXJzaW9uIDMgb2YgdGhlIExpY2Vuc2UsIG9yCiMgKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi4KCiMgVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsCiMgYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2YKIyBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlCiMgR05VIEFmZmVybyBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuCgojIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBBZmZlcm8gR2VuZXJhbCBQdWJsaWMgTGljZW5zZQojIGFsb25nIHdpdGggdGhpcyBwcm9ncmFtLiAgSWYgbm90LCBzZWUgPGh0dHBzOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi4KCmZyb20gdXRpbHMgaW1wb3J0IExPR0dFUgpmcm9tIHlvdXR1YmVfc2VhcmNoIGltcG9ydCBZb3V0dWJlU2VhcmNoCmZyb20gY29udGV4dGxpYiBpbXBvcnQgc3VwcHJlc3MKZnJvbSBweXJvZ3JhbS50eXBlcyBpbXBvcnQgTWVzc2FnZQpmcm9tIHl0X2RscCBpbXBvcnQgWW91dHViZURMCmZyb20gZGF0ZXRpbWUgaW1wb3J0IGRhdGV0aW1lCmZyb20gcHlyb2dyYW0gaW1wb3J0IGZpbHRlcnMKZnJvbSBjb25maWcgaW1wb3J0IENvbmZpZwpmcm9tIFBUTiBpbXBvcnQgcGFyc2UKaW1wb3J0IHJlCmZyb20gdXRpbHMgaW1wb3J0ICgKICAgIGFkZF90b19kYl9wbGF5bGlzdCwgCiAgICBjbGVhcl9kYl9wbGF5bGlzdCwgCiAgICBkZWxldGVfbWVzc2FnZXMsIAogICAgZG93bmxvYWQsIAogICAgZ2V0X2FkbWlucywgCiAgICBnZXRfZHVyYXRpb24sCiAgICBpc19hZG1pbiwgCiAgICBnZXRfYnV0dG9ucywgCiAgICBnZXRfbGluaywgCiAgICBpbXBvcnRfcGxheV9saXN0LCAKICAgIGlzX2F1ZGlvLCAKICAgIGxlYXZlX2NhbGwsIAogICAgcGxheSwgCiAgICBnZXRfcGxheWxpc3Rfc3RyLCAKICAgIHNlbmRfcGxheWxpc3QsIAogICAgc2h1ZmZsZV9wbGF5bGlzdCwgCiAgICBzdGFydF9zdHJlYW0sIAogICAgc3RyZWFtX2Zyb21fbGluaywgCiAgICBjaGF0X2ZpbHRlciwKICAgIGNfcGxheSwKICAgIGlzX3l0ZGxfc3VwcG9ydGVkCikKZnJvbSBweXJvZ3JhbS50eXBlcyBpbXBvcnQgKAogICAgSW5saW5lS2V5Ym9hcmRNYXJrdXAsIAogICAgSW5saW5lS2V5Ym9hcmRCdXR0b24KICAgICkKZnJvbSBweXJvZ3JhbS5lcnJvcnMgaW1wb3J0ICgKICAgIE1lc3NhZ2VJZEludmFsaWQsIAogICAgTWVzc2FnZU5vdE1vZGlmaWVkLAogICAgVXNlck5vdFBhcnRpY2lwYW50LAogICAgUGVlcklkSW52YWxpZCwKICAgIENoYW5uZWxJbnZhbGlkCiAgICApCmZyb20gcHlyb2dyYW0gaW1wb3J0ICgKICAgIENsaWVudCwgCiAgICBmaWx0ZXJzCiAgICApCgoKYWRtaW5fZmlsdGVyPWZpbHRlcnMuY3JlYXRlKGlzX2FkbWluKSAKCkBDbGllbnQub25fbWVzc2FnZShmaWx0ZXJzLmNvbW1hbmQoWyJwbGF5IiwgImZwbGF5IiwgZiJwbGF5QHtDb25maWcuQk9UX1VTRVJOQU1FfSIsIGYiZnBsYXlAe0NvbmZpZy5CT1RfVVNFUk5BTUV9Il0pICYgY2hhdF9maWx0ZXIpCmFzeW5jIGRlZiBhZGRfdG9fcGxheWxpc3QoXywgbWVzc2FnZTogTWVzc2FnZSk6CiAgICB3aXRoIHN1cHByZXNzKE1lc3NhZ2VJZEludmFsaWQsIE1lc3NhZ2VOb3RNb2RpZmllZCk6CiAgICAgICAgYWRtaW5zID0gYXdhaXQgZ2V0X2FkbWlucyhDb25maWcuQ0hBVCkKICAgICAgICBpZiBDb25maWcuQURNSU5fT05MWToKICAgICAgICAgICAgaWYgbm90IChtZXNzYWdlLmZyb21fdXNlciBpcyBOb25lIGFuZCBtZXNzYWdlLnNlbmRlcl9jaGF0IG9yIG1lc3NhZ2UuZnJvbV91c2VyLmlkIGluIGFkbWlucyk6CiAgICAgICAgICAgICAgICBrPWF3YWl0IG1lc3NhZ2UucmVwbHlfc3RpY2tlcigiQ0FBQ0FnRUFBeGtCQUFJbDlHRzdrU042YUlOZDY4NXZvZnhuaVJpREJYSnpBQUlsQWdBQ3RnZVlSRWJBemQwTjVGWExJd1EiKQogICAgICAgICAgICAgICAgYXdhaXQgZGVsZXRlX21lc3NhZ2VzKFttZXNzYWdlLCBrXSkKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgIHR5cGU9IiIKICAgICAgICB5dHVybD0iIgogICAgICAgIHlzZWFyY2g9IiIKICAgICAgICB1cmw9IiIKICAgICAgICBpZiBtZXNzYWdlLmNvbW1hbmRbMF0gPT0gImZwbGF5IjoKICAgICAgICAgICAgaWYgbm90IChtZXNzYWdlLmZyb21fdXNlciBpcyBOb25lIGFuZCBtZXNzYWdlLnNlbmRlcl9jaGF0IG9yIG1lc3NhZ2UuZnJvbV91c2VyLmlkIGluIGFkbWlucyk6CiAgICAgICAgICAgICAgICBrPWF3YWl0IG1lc3NhZ2UucmVwbHkoIlRoaXMgY29tbWFuZCBpcyBvbmx5IGZvciBhZG1pbnMuIikKICAgICAgICAgICAgICAgIGF3YWl0IGRlbGV0ZV9tZXNzYWdlcyhbbWVzc2FnZSwga10pCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICBtc2cgPSBhd2FpdCBtZXNzYWdlLnJlcGx5X3RleHQoIuKaoe+4jyAqKtmK2KrZhSDYp9mE2KrYrdmC2YIg2YXZhiDYp9mE2YXYudmE2YjZhdin2Kog2KfZhNmF2K/YrtmE2KkuLi4uKioiKQogICAgICAgIGlmIG1lc3NhZ2UucmVwbHlfdG9fbWVzc2FnZSBhbmQgbWVzc2FnZS5yZXBseV90b19tZXNzYWdlLnZpZGVvOgogICAgICAgICAgICBhd2FpdCBtc2cuZWRpdCgi4pqh77iPICoqQ2hlY2tpbmcgVGVsZWdyYW0gTWVkaWEuLi4qKiIpCiAgICAgICAgICAgIHR5cGU9J3ZpZGVvJwogICAgICAgICAgICBtX3ZpZGVvID0gbWVzc2FnZS5yZXBseV90b19tZXNzYWdlLnZpZGVvICAgICAgIAogICAgICAgIGVsaWYgbWVzc2FnZS5yZXBseV90b19tZXNzYWdlIGFuZCBtZXNzYWdlLnJlcGx5X3RvX21lc3NhZ2UuZG9jdW1lbnQ6CiAgICAgICAgICAgIGF3YWl0IG1zZy5lZGl0KCLimqHvuI8gKipDaGVja2luZyBUZWxlZ3JhbSBNZWRpYS4uLioqIikKICAgICAgICAgICAgbV92aWRlbyA9IG1lc3NhZ2UucmVwbHlfdG9fbWVzc2FnZS5kb2N1bWVudAogICAgICAgICAgICB0eXBlPSd2aWRlbycKICAgICAgICAgICAgaWYgbm90ICJ2aWRlbyIgaW4gbV92aWRlby5taW1lX3R5cGU6CiAgICAgICAgICAgICAgICByZXR1cm4gYXdhaXQgbXNnLmVkaXQoIlRoZSBnaXZlbiBmaWxlIGlzIGludmFsaWQiKQogICAgICAgIGVsaWYgbWVzc2FnZS5yZXBseV90b19tZXNzYWdlIGFuZCBtZXNzYWdlLnJlcGx5X3RvX21lc3NhZ2UuYXVkaW86CiAgICAgICAgICAgICNpZiBub3QgQ29uZmlnLklTX1ZJREVPOgogICAgICAgICAgICAgICAgI3JldHVybiBhd2FpdCBtZXNzYWdlLnJlcGx5KCJQbGF5IGZyb20gYXVkaW8gZmlsZSBpcyBhdmFpbGFibGUgb25seSBpZiBWaWRlbyBNb2RlIGlmIHR1cm5lZCBvZmYuXG5Vc2UgL3NldHRpbmdzIHRvIGNvbmZpZ3VyZSB5cHVyIHBsYXllci4iKQogICAgICAgICAgICBhd2FpdCBtc2cuZWRpdCgi4pqh77iPICoqQ2hlY2tpbmcgVGVsZWdyYW0gTWVkaWEuLi4qKiIpCiAgICAgICAgICAgIHR5cGU9J2F1ZGlvJwogICAgICAgICAgICBtX3ZpZGVvID0gbWVzc2FnZS5yZXBseV90b19tZXNzYWdlLmF1ZGlvICAgICAgIAogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGlmIG1lc3NhZ2UucmVwbHlfdG9fbWVzc2FnZSBhbmQgbWVzc2FnZS5yZXBseV90b19tZXNzYWdlLnRleHQ6CiAgICAgICAgICAgICAgICBxdWVyeT1tZXNzYWdlLnJlcGx5X3RvX21lc3NhZ2UudGV4dAogICAgICAgICAgICBlbGlmICIgIiBpbiBtZXNzYWdlLnRleHQ6CiAgICAgICAgICAgICAgICB0ZXh0ID0gbWVzc2FnZS50ZXh0LnNwbGl0KCIgIiwgMSkKICAgICAgICAgICAgICAgIHF1ZXJ5ID0gdGV4dFsxXQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgYXdhaXQgbXNnLmVkaXQoItmE2YUg2KrYudi32YbZiiDYo9mKINi02YrYoSDZhNiq2LTYutmK2YTZhyDYjNmC2YUg2KjYp9mE2LHYryDYudmE2Ykg2YXZgti32Lkg2YHZitiv2YrZiCDYo9mIINix2KfYqNi3IHlvdXR1YmUg2YXYqNin2LTYsS4uLi4uLiAiKQogICAgICAgICAgICAgICAgYXdhaXQgZGVsZXRlX21lc3NhZ2VzKFttZXNzYWdlLCBtc2ddKQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIHJlZ2V4ID0gciJeKD86aHR0cHM/OlwvXC8pPyg/Ond3d1wuKT95b3V0dVwuP2JlKD86XC5jb20pP1wvPy4qKD86d2F0Y2h8ZW1iZWQpPyg/Oi4qdj18dlwvfFwvKShbXHdcLV9dKylcJj8iCiAgICAgICAgICAgIG1hdGNoID0gcmUubWF0Y2gocmVnZXgscXVlcnkpCiAgICAgICAgICAgIGlmIG1hdGNoOgogICAgICAgICAgICAgICAgdHlwZT0ieW91dHViZSIKICAgICAgICAgICAgICAgIHl0dXJsPXF1ZXJ5CiAgICAgICAgICAgIGVsaWYgcXVlcnkuc3RhcnRzd2l0aCgiaHR0cCIpOgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIGhhc19hdWRpb18gPSBhd2FpdCBpc19hdWRpbyhxdWVyeSkKICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICBoYXNfYXVkaW9fID0gRmFsc2UKICAgICAgICAgICAgICAgICAgICBMT0dHRVIuZXJyb3IoIlVuYWJsZSB0byBnZXQgQXVkaW8gcHJvcGVydGllcyB3aXRoaW4gdGltZS4iKQogICAgICAgICAgICAgICAgaWYgaGFzX2F1ZGlvXzoKICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgIGR1cj1hd2FpdCBnZXRfZHVyYXRpb24ocXVlcnkpCiAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICBkdXI9MAogICAgICAgICAgICAgICAgICAgIGlmIGR1ciA9PSAwOgogICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBtc2cuZWRpdCgiVGhpcyBpcyBhIGxpdmUgc3RyZWFtLCBVc2UgL3N0cmVhbSBjb21tYW5kLiIpCiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IGRlbGV0ZV9tZXNzYWdlcyhbbWVzc2FnZSwgbXNnXSkKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIAogICAgICAgICAgICAgICAgICAgIHR5cGU9ImRpcmVjdCIKICAgICAgICAgICAgICAgICAgICB1cmw9cXVlcnkKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgaWYgaXNfeXRkbF9zdXBwb3J0ZWQocXVlcnkpOgogICAgICAgICAgICAgICAgICAgICAgICB0eXBlPSJ5dGRsX3MiCiAgICAgICAgICAgICAgICAgICAgICAgIHVybD1xdWVyeQogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IG1zZy5lZGl0KCJUaGlzIGlzIGFuIGludmFsaWQgbGluaywgcHJvdmlkZSBtZSBhIGRpcmVjdCBsaW5rIG9yIGEgeW91dHViZSBsaW5rLiIpCiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IGRlbGV0ZV9tZXNzYWdlcyhbbWVzc2FnZSwgbXNnXSkKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICB0eXBlPSJxdWVyeSIKICAgICAgICAgICAgICAgIHlzZWFyY2g9cXVlcnkKICAgICAgICBpZiBub3QgbWVzc2FnZS5mcm9tX3VzZXIgaXMgTm9uZToKICAgICAgICAgICAgdXNlcj1mIlt7bWVzc2FnZS5mcm9tX3VzZXIuZmlyc3RfbmFtZX1dKHRnOi8vdXNlcj9pZD17bWVzc2FnZS5mcm9tX3VzZXIuaWR9KSIKICAgICAgICAgICAgdXNlcl9pZCA9IG1lc3NhZ2UuZnJvbV91c2VyLmlkCiAgICAgICAgZWxzZToKICAgICAgICAgICAgdXNlcj0iQW5vbnltb3VzIgogICAgICAgICAgICB1c2VyX2lkID0gImFub255bW91c19hZG1pbiIKICAgICAgICBub3cgPSBkYXRldGltZS5ub3coKQogICAgICAgIG55YXYgPSBub3cuc3RyZnRpbWUoIiVkLSVtLSVZLSVIOiVNOiVTIikKICAgICAgICBpZiB0eXBlIGluIFsidmlkZW8iLCAiYXVkaW8iXToKICAgICAgICAgICAgaWYgdHlwZSA9PSAiYXVkaW8iOgogICAgICAgICAgICAgICAgaWYgbV92aWRlby50aXRsZSBpcyBOb25lOgogICAgICAgICAgICAgICAgICAgIGlmIG1fdmlkZW8uZmlsZV9uYW1lIGlzIE5vbmU6CiAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlXyA9ICJNdXNpYyIKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICB0aXRsZV8gPSBtX3ZpZGVvLmZpbGVfbmFtZQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICB0aXRsZV8gPSBtX3ZpZGVvLnRpdGxlCiAgICAgICAgICAgICAgICBpZiBtX3ZpZGVvLnBlcmZvcm1lciBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgICAgICB0aXRsZSA9IGYie21fdmlkZW8ucGVyZm9ybWVyfSAtIHt0aXRsZV99IgogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICB0aXRsZT10aXRsZV8KICAgICAgICAgICAgICAgIHVuaXF1ZSA9IGYie255YXZ9X3ttX3ZpZGVvLmZpbGVfc2l6ZX1fYXVkaW8iCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICB0aXRsZT1tX3ZpZGVvLmZpbGVfbmFtZQogICAgICAgICAgICAgICAgdW5pcXVlID0gZiJ7bnlhdn1fe21fdmlkZW8uZmlsZV9zaXplfV92aWRlbyIKICAgICAgICAgICAgICAgIGlmIENvbmZpZy5QVE46CiAgICAgICAgICAgICAgICAgICAgbnkgPSBwYXJzZSh0aXRsZSkKICAgICAgICAgICAgICAgICAgICB0aXRsZV8gPSBueS5nZXQoInRpdGxlIikKICAgICAgICAgICAgICAgICAgICBpZiB0aXRsZV86CiAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlID0gdGl0bGVfCiAgICAgICAgICAgIGZpbGVfaWQ9bV92aWRlby5maWxlX2lkCiAgICAgICAgICAgIGlmIHRpdGxlIGlzIE5vbmU6CiAgICAgICAgICAgICAgICB0aXRsZSA9ICdNdXNpYycKICAgICAgICAgICAgZGF0YT17MTp0aXRsZSwgMjpmaWxlX2lkLCAzOiJ0ZWxlZ3JhbSIsIDQ6dXNlciwgNTp1bmlxdWV9CiAgICAgICAgICAgIGlmIG1lc3NhZ2UuY29tbWFuZFswXSA9PSAiZnBsYXkiOgogICAgICAgICAgICAgICAgcGxhID0gW2RhdGFdICsgQ29uZmlnLnBsYXlsaXN0CiAgICAgICAgICAgICAgICBDb25maWcucGxheWxpc3QgPSBwbGEKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIENvbmZpZy5wbGF5bGlzdC5hcHBlbmQoZGF0YSkKICAgICAgICAgICAgYXdhaXQgYWRkX3RvX2RiX3BsYXlsaXN0KGRhdGEpICAgICAgICAKICAgICAgICAgICAgYXdhaXQgbXNnLmVkaXQoIk1lZGlhIGFkZGVkIHRvIHBsYXlsaXN0IikKICAgICAgICBlbGlmIHR5cGUgaW4gWyJ5b3V0dWJlIiwgInF1ZXJ5IiwgInl0ZGxfcyJdOgogICAgICAgICAgICBpZiB0eXBlPT0ieW91dHViZSI6CiAgICAgICAgICAgICAgICBhd2FpdCBtc2cuZWRpdCgi4pqh77iPICoq2KzYp9ixINin2YTYqNit2Ksg2LnZhiDYp9mE2YHZitiv2YrZiCDZgdmKINin2YTZitmI2KrZitmI2KguLi4qKiIpCiAgICAgICAgICAgICAgICB1cmw9eXR1cmwKICAgICAgICAgICAgZWxpZiB0eXBlPT0icXVlcnkiOgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIGF3YWl0IG1zZy5lZGl0KCLimqHvuI8gKirYrNin2LEg2KfZhNio2K3YqyDYudmGINin2YTZgdmK2K/ZitmIINmB2Yog2KfZhNmK2YjYqtmK2YjYqC4uLioqIikKICAgICAgICAgICAgICAgICAgICB5dHF1ZXJ5PXlzZWFyY2gKICAgICAgICAgICAgICAgICAgICByZXN1bHRzID0gWW91dHViZVNlYXJjaCh5dHF1ZXJ5LCBtYXhfcmVzdWx0cz0xKS50b19kaWN0KCkKICAgICAgICAgICAgICAgICAgICB1cmwgPSBmImh0dHBzOi8veW91dHViZS5jb217cmVzdWx0c1swXVsndXJsX3N1ZmZpeCddfSIKICAgICAgICAgICAgICAgICAgICB0aXRsZSA9IHJlc3VsdHNbMF1bInRpdGxlIl1bOjQwXQogICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgICAgIGF3YWl0IG1zZy5lZGl0KAogICAgICAgICAgICAgICAgICAgICAgICAiU29uZyBub3QgZm91bmQuXG5UcnkgaW5saW5lIG1vZGUuLiIKICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgTE9HR0VSLmVycm9yKHN0cihlKSwgZXhjX2luZm89VHJ1ZSkKICAgICAgICAgICAgICAgICAgICBhd2FpdCBkZWxldGVfbWVzc2FnZXMoW21lc3NhZ2UsIG1zZ10pCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIGVsaWYgdHlwZSA9PSAieXRkbF9zIjoKICAgICAgICAgICAgICAgIHVybD11cmwKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB5ZGxfb3B0cyA9IHsKICAgICAgICAgICAgICAgICJxdWl0ZSI6IFRydWUsCiAgICAgICAgICAgICAgICAiZ2VvLWJ5cGFzcyI6IFRydWUsCiAgICAgICAgICAgICAgICAibm9jaGVja2NlcnRpZmljYXRlIjogVHJ1ZQogICAgICAgICAgICB9CiAgICAgICAgICAgIHlkbCA9IFlvdXR1YmVETCh5ZGxfb3B0cykKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgaW5mbyA9IHlkbC5leHRyYWN0X2luZm8odXJsLCBGYWxzZSkKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgTE9HR0VSLmVycm9yKGUsIGV4Y19pbmZvPVRydWUpCiAgICAgICAgICAgICAgICBhd2FpdCBtc2cuZWRpdCgKICAgICAgICAgICAgICAgICAgICBmIllvdVR1YmUgRG93bmxvYWQgRXJyb3Ig4p2MXG5FcnJvcjotIHtlfSIKICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICBMT0dHRVIuZXJyb3Ioc3RyKGUpKQogICAgICAgICAgICAgICAgYXdhaXQgZGVsZXRlX21lc3NhZ2VzKFttZXNzYWdlLCBtc2ddKQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIGlmIHR5cGUgPT0gInl0ZGxfcyI6CiAgICAgICAgICAgICAgICB0aXRsZSA9ICJNdXNpYyIKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICB0aXRsZSA9IGluZm9bJ3RpdGxlJ10KICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICBwYXNzCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICB0aXRsZSA9IGluZm9bInRpdGxlIl0KICAgICAgICAgICAgICAgIGlmIGluZm9bJ2R1cmF0aW9uJ10gaXMgTm9uZToKICAgICAgICAgICAgICAgICAgICBhd2FpdCBtc2cuZWRpdCgiVGhpcyBpcyBhIGxpdmUgc3RyZWFtLCBVc2UgL3N0cmVhbSBjb21tYW5kLiIpCiAgICAgICAgICAgICAgICAgICAgYXdhaXQgZGVsZXRlX21lc3NhZ2VzKFttZXNzYWdlLCBtc2ddKQogICAgICAgICAgICAgICAgICAgIHJldHVybiAKICAgICAgICAgICAgZGF0YT17MTp0aXRsZSwgMjp1cmwsIDM6InlvdXR1YmUiLCA0OnVzZXIsIDU6ZiJ7bnlhdn1fe3VzZXJfaWR9In0KICAgICAgICAgICAgaWYgbWVzc2FnZS5jb21tYW5kWzBdID09ICJmcGxheSI6CiAgICAgICAgICAgICAgICBwbGEgPSBbZGF0YV0gKyBDb25maWcucGxheWxpc3QKICAgICAgICAgICAgICAgIENvbmZpZy5wbGF5bGlzdCA9IHBsYQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgQ29uZmlnLnBsYXlsaXN0LmFwcGVuZChkYXRhKQogICAgICAgICAgICBhd2FpdCBhZGRfdG9fZGJfcGxheWxpc3QoZGF0YSkKICAgICAgICAgICAgYXdhaXQgbXNnLmVkaXQoZiJbe3RpdGxlfV0oe3VybH0pIGFkZGVkIHRvIHBsYXlpc3QiLCBkaXNhYmxlX3dlYl9wYWdlX3ByZXZpZXc9VHJ1ZSkKICAgICAgICBlbGlmIHR5cGUgPT0gImRpcmVjdCI6CiAgICAgICAgICAgIGRhdGE9ezE6Ik11c2ljIiwgMjp1cmwsIDM6InVybCIsIDQ6dXNlciwgNTpmIntueWF2fV97dXNlcl9pZH0ifQogICAgICAgICAgICBpZiBtZXNzYWdlLmNvbW1hbmRbMF0gPT0gImZwbGF5IjoKICAgICAgICAgICAgICAgIHBsYSA9IFtkYXRhXSArIENvbmZpZy5wbGF5bGlzdAogICAgICAgICAgICAgICAgQ29uZmlnLnBsYXlsaXN0ID0gcGxhCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBDb25maWcucGxheWxpc3QuYXBwZW5kKGRhdGEpCiAgICAgICAgICAgIGF3YWl0IGFkZF90b19kYl9wbGF5bGlzdChkYXRhKSAgICAgICAgCiAgICAgICAgICAgIGF3YWl0IG1zZy5lZGl0KCJMaW5rIGFkZGVkIHRvIHBsYXlsaXN0IikKICAgICAgICBpZiBub3QgQ29uZmlnLkNBTExfU1RBVFVTIFwKICAgICAgICAgICAgYW5kIGxlbihDb25maWcucGxheWxpc3QpID49IDE6CiAgICAgICAgICAgIGF3YWl0IG1zZy5lZGl0KCLYrNin2LEg2KrYtNi62YrZhCDYp9mE2YHZitiv2YrZiOOAve+4jy4uLi4iKQogICAgICAgICAgICBhd2FpdCBkb3dubG9hZChDb25maWcucGxheWxpc3RbMF0sIG1zZykKICAgICAgICAgICAgYXdhaXQgcGxheSgpCiAgICAgICAgZWxpZiAobGVuKENvbmZpZy5wbGF5bGlzdCkgPT0gMSBhbmQgQ29uZmlnLkNBTExfU1RBVFVTKToKICAgICAgICAgICAgYXdhaXQgbXNnLmVkaXQoItis2KfYsSDYqti02LrZitmEINin2YTZgdmK2K/ZitmI44C977iPLi4uLiAiKQogICAgICAgICAgICBhd2FpdCBkb3dubG9hZChDb25maWcucGxheWxpc3RbMF0sIG1zZykgIAogICAgICAgICAgICBhd2FpdCBwbGF5KCkKICAgICAgICBlbGlmIG1lc3NhZ2UuY29tbWFuZFswXSA9PSAiZnBsYXkiOgogICAgICAgICAgICBhd2FpdCBtc2cuZWRpdCgi2KzYp9ixINiq2LTYutmK2YQg2KfZhNmB2YrYr9mK2YjjgL3vuI8uIC4uLiIpCiAgICAgICAgICAgIGF3YWl0IGRvd25sb2FkKENvbmZpZy5wbGF5bGlzdFswXSwgbXNnKSAgCiAgICAgICAgICAgIGF3YWl0IHBsYXkoKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGF3YWl0IHNlbmRfcGxheWxpc3QoKSAgCiAgICAgICAgYXdhaXQgbXNnLmRlbGV0ZSgpCiAgICAgICAgcGw9YXdhaXQgZ2V0X3BsYXlsaXN0X3N0cigpCiAgICAgICAgaWYgbWVzc2FnZS5jaGF0LnR5cGUgPT0gInByaXZhdGUiOgogICAgICAgICAgICBhd2FpdCBtZXNzYWdlLnJlcGx5KHBsLCByZXBseV9tYXJrdXA9YXdhaXQgZ2V0X2J1dHRvbnMoKSAsZGlzYWJsZV93ZWJfcGFnZV9wcmV2aWV3PVRydWUpICAgICAgIAogICAgICAgIGVsaWYgbm90IENvbmZpZy5MT0dfR1JPVVAgYW5kIG1lc3NhZ2UuY2hhdC50eXBlID09ICJzdXBlcmdyb3VwIjoKICAgICAgICAgICAgaWYgQ29uZmlnLm1zZy5nZXQoJ3BsYXlsaXN0JykgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICBhd2FpdCBDb25maWcubXNnWydwbGF5bGlzdCddLmRlbGV0ZSgpCiAgICAgICAgICAgIENvbmZpZy5tc2dbJ3BsYXlsaXN0J109YXdhaXQgbWVzc2FnZS5yZXBseShwbCwgZGlzYWJsZV93ZWJfcGFnZV9wcmV2aWV3PVRydWUsIHJlcGx5X21hcmt1cD1hd2FpdCBnZXRfYnV0dG9ucygpKSAgICAKICAgICAgICAgICAgYXdhaXQgZGVsZXRlX21lc3NhZ2VzKFttZXNzYWdlXSkgIAogICAgICAgIGZvciB0cmFjayBpbiBDb25maWcucGxheWxpc3RbOjJdOgogICAgICAgICAgICBhd2FpdCBkb3dubG9hZCh0cmFjaykKCgpAQ2xpZW50Lm9uX21lc3NhZ2UoZmlsdGVycy5jb21tYW5kKFsibGVhdmUiLCBmImxlYXZlQHtDb25maWcuQk9UX1VTRVJOQU1FfSJdKSAmIGFkbWluX2ZpbHRlciAmIGNoYXRfZmlsdGVyKQphc3luYyBkZWYgbGVhdmVfdm9pY2VfY2hhdChfLCBtOiBNZXNzYWdlKToKICAgIGlmIG5vdCBDb25maWcuQ0FMTF9TVEFUVVM6ICAgICAgICAKICAgICAgICBrPWF3YWl0IG0ucmVwbHkoIk5vdCBqb2luZWQgYW55IHZvaWNlY2hhdC4iKQogICAgICAgIGF3YWl0IGRlbGV0ZV9tZXNzYWdlcyhbbSwga10pCiAgICAgICAgcmV0dXJuCiAgICBhd2FpdCBsZWF2ZV9jYWxsKCkKICAgIGs9YXdhaXQgbS5yZXBseSgiU3VjY2VzZnVsbHkgbGVmdCB2aWRlb2NoYXQuIikKICAgIGF3YWl0IGRlbGV0ZV9tZXNzYWdlcyhbbSwga10pCgoKCkBDbGllbnQub25fbWVzc2FnZShmaWx0ZXJzLmNvbW1hbmQoWyJzaHVmZmxlIiwgZiJzaHVmZmxlQHtDb25maWcuQk9UX1VTRVJOQU1FfSJdKSAmIGFkbWluX2ZpbHRlciAmIGNoYXRfZmlsdGVyKQphc3luYyBkZWYgc2h1ZmZsZV9wbGF5X2xpc3QoY2xpZW50LCBtOiBNZXNzYWdlKToKICAgIGlmIG5vdCBDb25maWcuQ0FMTF9TVEFUVVM6CiAgICAgICAgayA9IGF3YWl0IG0ucmVwbHkoIk5vdCBqb2luZWQgYW55IHZvaWNlY2hhdC4iKQogICAgICAgIGF3YWl0IGRlbGV0ZV9tZXNzYWdlcyhbbSwga10pCiAgICAgICAgcmV0dXJuCiAgICBlbHNlOgogICAgICAgIGlmIGxlbihDb25maWcucGxheWxpc3QpID4gMjoKICAgICAgICAgICAgaz1hd2FpdCBtLnJlcGx5X3RleHQoZiJQbGF5bGlzdCBTaHVmZmxlZC4iKQogICAgICAgICAgICBhd2FpdCBzaHVmZmxlX3BsYXlsaXN0KCkKICAgICAgICAgICAgYXdhaXQgZGVsZXRlX21lc3NhZ2VzKFttLCBrXSkgICAgICAgICAgICAKICAgICAgICBlbHNlOgogICAgICAgICAgICBrPWF3YWl0IG0ucmVwbHlfdGV4dChmIllvdSBjYW50IHNodWZmbGUgcGxheWxpc3Qgd2l0aCBsZXNzIHRoYW4gMyBzb25ncy4iKQogICAgICAgICAgICBhd2FpdCBkZWxldGVfbWVzc2FnZXMoW20sIGtdKQoKCkBDbGllbnQub25fbWVzc2FnZShmaWx0ZXJzLmNvbW1hbmQoWyJjbGVhcnBsYXlsaXN0IiwgZiJjbGVhcnBsYXlsaXN0QHtDb25maWcuQk9UX1VTRVJOQU1FfSJdKSAmIGFkbWluX2ZpbHRlciAmIGNoYXRfZmlsdGVyKQphc3luYyBkZWYgY2xlYXJfcGxheV9saXN0KGNsaWVudCwgbTogTWVzc2FnZSk6CiAgICBpZiBub3QgQ29uZmlnLnBsYXlsaXN0OgogICAgICAgIGsgPSBhd2FpdCBtLnJlcGx5KCJQbGF5bGlzdCBpcyBlbXB0eS4iKSAgCiAgICAgICAgYXdhaXQgZGVsZXRlX21lc3NhZ2VzKFttLCBrXSkKICAgICAgICByZXR1cm4KICAgIENvbmZpZy5wbGF5bGlzdC5jbGVhcigpCiAgICBrPWF3YWl0IG0ucmVwbHlfdGV4dChmIlBsYXlsaXN0IENsZWFyZWQuIikKICAgIGF3YWl0IGNsZWFyX2RiX3BsYXlsaXN0KGFsbD1UcnVlKQogICAgaWYgQ29uZmlnLklTX0xPT1AgXAogICAgICAgIGFuZCBub3QgKENvbmZpZy5ZUExBWSBvciBDb25maWcuQ1BMQVkpOgogICAgICAgIGF3YWl0IHN0YXJ0X3N0cmVhbSgpCiAgICBlbHNlOgogICAgICAgIGF3YWl0IGxlYXZlX2NhbGwoKQogICAgYXdhaXQgZGVsZXRlX21lc3NhZ2VzKFttLCBrXSkKCgoKQENsaWVudC5vbl9tZXNzYWdlKGZpbHRlcnMuY29tbWFuZChbImNwbGF5IiwgZiJjcGxheUB7Q29uZmlnLkJPVF9VU0VSTkFNRX0iXSkgJiBhZG1pbl9maWx0ZXIgJiBjaGF0X2ZpbHRlcikKYXN5bmMgZGVmIGNoYW5uZWxfcGxheV9saXN0KGNsaWVudCwgbTogTWVzc2FnZSk6CiAgICB3aXRoIHN1cHByZXNzKE1lc3NhZ2VJZEludmFsaWQsIE1lc3NhZ2VOb3RNb2RpZmllZCk6CiAgICAgICAgaz1hd2FpdCBtLnJlcGx5KCJTZXR0aW5nIHVwIGZvciBjaGFubmVsIHBsYXkuLiIpCiAgICAgICAgaWYgIiAiIGluIG0udGV4dDoKICAgICAgICAgICAgeW91LCBtZSA9IG0udGV4dC5zcGxpdCgiICIsIDEpCiAgICAgICAgICAgIGlmIG1lLnN0YXJ0c3dpdGgoIi0xMDAiKToKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBtZT1pbnQobWUpCiAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgYXdhaXQgay5lZGl0KCJJbnZhbGlkIGNoYXQgaWQgZ2l2ZW4iKQogICAgICAgICAgICAgICAgICAgIGF3YWl0IGRlbGV0ZV9tZXNzYWdlcyhbbSwga10pCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgYXdhaXQgY2xpZW50LmdldF9jaGF0X21lbWJlcihpbnQobWUpLCBDb25maWcuVVNFUl9JRCkKICAgICAgICAgICAgICAgIGV4Y2VwdCAoVmFsdWVFcnJvciwgUGVlcklkSW52YWxpZCwgQ2hhbm5lbEludmFsaWQpOgogICAgICAgICAgICAgICAgICAgIExPR0dFUi5lcnJvcihmIkdpdmVuIGNoYW5uZWwgaXMgcHJpdmF0ZSBhbmQgQHtDb25maWcuQk9UX1VTRVJOQU1FfSBpcyBub3QgYW4gYWRtaW4gb3ZlciB0aGVyZS4iLCBleGNfaW5mbz1UcnVlKQogICAgICAgICAgICAgICAgICAgIGF3YWl0IGsuZWRpdChmIkdpdmVuIGNoYW5uZWwgaXMgcHJpdmF0ZSBhbmQgQHtDb25maWcuQk9UX1VTRVJOQU1FfSBpcyBub3QgYW4gYWRtaW4gb3ZlciB0aGVyZS4gSWYgY2hhbm5lbCBpcyBub3QgcHJpdmF0ZSAsIHBsZWFzZSBwcm92aWRlIHVzZXJuYW1lIG9mIGNoYW5uZWwuIikKICAgICAgICAgICAgICAgICAgICBhd2FpdCBkZWxldGVfbWVzc2FnZXMoW20sIGtdKQogICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgZXhjZXB0IFVzZXJOb3RQYXJ0aWNpcGFudDoKICAgICAgICAgICAgICAgICAgICBMT0dHRVIuZXJyb3IoIkdpdmVuIGNoYW5uZWwgaXMgcHJpdmF0ZSBhbmQgVVNFUiBhY2NvdW50IGlzIG5vdCBhIG1lbWJlciBvZiBjaGFubmVsLiIpCiAgICAgICAgICAgICAgICAgICAgYXdhaXQgay5lZGl0KCJHaXZlbiBjaGFubmVsIGlzIHByaXZhdGUgYW5kIFVTRVIgYWNjb3VudCBpcyBub3QgYSBtZW1iZXIgb2YgY2hhbm5lbC4iKQogICAgICAgICAgICAgICAgICAgIGF3YWl0IGRlbGV0ZV9tZXNzYWdlcyhbbSwga10pCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICAgICAgTE9HR0VSLmVycm9yKGYiRXJyb3JzIG9jY3VyZWQgd2hpbGUgZ2V0dGluZyBkYXRhIGFib3VudCBjaGFubmVsIC0ge2V9IiwgZXhjX2luZm89VHJ1ZSkKICAgICAgICAgICAgICAgICAgICBhd2FpdCBrLmVkaXQoZiJTb21ldGhpbmcgd2VudCB3cm9uZy0ge2V9IikKICAgICAgICAgICAgICAgICAgICBhd2FpdCBkZWxldGVfbWVzc2FnZXMoW20sIGtdKQogICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgYXdhaXQgay5lZGl0KCJTZWFyY2hpbmcgZmlsZXMgZnJvbSBjaGFubmVsLCB0aGlzIG1heSB0YWtlIHNvbWUgdGltZSwgZGVwZW5kaW5nIG9uIG51bWJlciBvZiBmaWxlcyBpbiB0aGUgY2hhbm5lbC4iKQogICAgICAgICAgICAgICAgc3QsIG1zZyA9IGF3YWl0IGNfcGxheShtZSkKICAgICAgICAgICAgICAgIGlmIHN0ID09IEZhbHNlOgogICAgICAgICAgICAgICAgICAgIGF3YWl0IG0uZWRpdChtc2cpCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIGF3YWl0IGsuZWRpdChmIlN1Y2Nlc2Z1bGx5IGFkZGVkIHttc2d9IGZpbGVzIHRvIHBsYXlsaXN0LiIpCiAgICAgICAgICAgIGVsaWYgbWUuc3RhcnRzd2l0aCgiQCIpOgogICAgICAgICAgICAgICAgbWUgPSBtZS5yZXBsYWNlKCJAIiwgIiIpCiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgY2hhdD1hd2FpdCBjbGllbnQuZ2V0X2NoYXQobWUpCiAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICAgICAgTE9HR0VSLmVycm9yKGYiRXJyb3JzIG9jY3VyZWQgd2hpbGUgZmV0Y2hpbmcgaW5mbyBhYm91dCBjaGFubmVsIC0ge2V9IiwgZXhjX2luZm89VHJ1ZSkKICAgICAgICAgICAgICAgICAgICBhd2FpdCBrLmVkaXQoZiJFcnJvcnMgb2NjdXJlZCB3aGlsZSBnZXR0aW5nIGRhdGEgYWJvdXQgY2hhbm5lbCAtIHtlfSIpCiAgICAgICAgICAgICAgICAgICAgYXdhaXQgZGVsZXRlX21lc3NhZ2VzKFttLCBrXSkKICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgIGF3YWl0IGsuZWRpdCgiU2VhcmNoaW5nIGZpbGVzIGZyb20gY2hhbm5lbCwgdGhpcyBtYXkgdGFrZSBzb21lIHRpbWUsIGRlcGVuZGluZyBvbiBudW1iZXIgb2YgZmlsZXMgaW4gdGhlIGNoYW5uZWwuIikKICAgICAgICAgICAgICAgIHN0LCBtc2c9YXdhaXQgY19wbGF5KG1lKQogICAgICAgICAgICAgICAgaWYgc3QgPT0gRmFsc2U6CiAgICAgICAgICAgICAgICAgICAgYXdhaXQgay5lZGl0KG1zZykKICAgICAgICAgICAgICAgICAgICBhd2FpdCBkZWxldGVfbWVzc2FnZXMoW20sIGtdKQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBhd2FpdCBrLmVkaXQoZiJTdWNjZXNmdWxseSBBZGRlZCB7bXNnfSBmaWxlcyBmcm9tIHtjaGF0LnRpdGxlfSB0byBwbGF5bGlzdCIpCiAgICAgICAgICAgICAgICAgICAgYXdhaXQgZGVsZXRlX21lc3NhZ2VzKFttLCBrXSkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGF3YWl0IGsuZWRpdCgiVGhlIGdpdmVuIGNoYW5uZWwgaXMgaW52YWxpZC4gRm9yIHByaXZhdGUgY2hhbm5lbHMgaXQgc2hvdWxkIHN0YXJ0IHdpdGggLTEwMCBhbmQgZm9yIHB1YmxpYyBjaGFubmVscyBpdCBzaG91bGQgc3RhcnQgd2l0aCBAXG5FeGFtcGxlcyAtIGAvY3BsYXkgIG9yIC9jcGxheSAtMTAwMTI1MzY5ODY1XG5cbkZvciBwcml2YXRlIGNoYW5uZWwsIGJvdGggYm90IGFuZCB0aGUgVVNFUiBhY2NvdW50IHNob3VsZCBiZSBtZW1iZXJzIG9mIGNoYW5uZWwuIikKICAgICAgICAgICAgICAgIGF3YWl0IGRlbGV0ZV9tZXNzYWdlcyhbbSwga10pCiAgICAgICAgZWxzZToKICAgICAgICAgICAgYXdhaXQgay5lZGl0KCJZb3UgZGlkbid0IGdhdmUgbWUgYW55IGNoYW5uZWwuIEdpdmUgbWUgYSBjaGFubmVsIGlkIG9yIHVzZXJuYW1lIGZyb20gd2hpY2ggaSBzaG91bGQgcGxheSBmaWxlcyAuIFxuRm9yIHByaXZhdGUgY2hhbm5lbHMgaXQgc2hvdWxkIHN0YXJ0IHdpdGggLTEwMCBhbmQgZm9yIHB1YmxpYyBjaGFubmVscyBpdCBzaG91bGQgc3RhcnQgd2l0aCBAXG5FeGFtcGxlcyAtIGAvY3BsYXkgQGlQdXJleCBvciAvY3BsYXkgLTEwMDEyNTM2OTg2NVxuXG5Gb3IgcHJpdmF0ZSBjaGFubmVsLCBib3RoIGJvdCBhbmQgdGhlIFVTRVIgYWNjb3VudCBzaG91bGQgYmUgbWVtYmVycyBvZiBjaGFubmVsLiIpCiAgICAgICAgICAgIGF3YWl0IGRlbGV0ZV9tZXNzYWdlcyhbbSwga10pCgoKCkBDbGllbnQub25fbWVzc2FnZShmaWx0ZXJzLmNvbW1hbmQoWyJ5cGxheSIsIGYieXBsYXlAe0NvbmZpZy5CT1RfVVNFUk5BTUV9Il0pICYgYWRtaW5fZmlsdGVyICYgY2hhdF9maWx0ZXIpCmFzeW5jIGRlZiB5dF9wbGF5X2xpc3QoY2xpZW50LCBtOiBNZXNzYWdlKToKICAgIHdpdGggc3VwcHJlc3MoTWVzc2FnZUlkSW52YWxpZCwgTWVzc2FnZU5vdE1vZGlmaWVkKToKICAgICAgICBpZiBtLnJlcGx5X3RvX21lc3NhZ2UgaXMgbm90IE5vbmUgYW5kIG0ucmVwbHlfdG9fbWVzc2FnZS5kb2N1bWVudDoKICAgICAgICAgICAgaWYgbS5yZXBseV90b19tZXNzYWdlLmRvY3VtZW50LmZpbGVfbmFtZSAhPSAiWW91VHViZV9QbGF5TGlzdC5qc29uIjoKICAgICAgICAgICAgICAgIGs9YXdhaXQgbS5yZXBseSgiSW52YWxpZCBQbGF5TGlzdCBmaWxlIGdpdmVuLiBVc2UgQGlQdXJleCAgb3Igc2VhcmNoIGZvciBhIHBsYXlsaXN0IGluIEBpUHVyZXggdG8gZ2V0IGEgcGxheWxpc3QgZmlsZS4iKQogICAgICAgICAgICAgICAgYXdhaXQgZGVsZXRlX21lc3NhZ2VzKFttLCBrXSkKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB5dHBsYXlsaXN0PWF3YWl0IG0ucmVwbHlfdG9fbWVzc2FnZS5kb3dubG9hZCgpCiAgICAgICAgICAgIHN0YXR1cz1hd2FpdCBtLnJlcGx5KCJUcnlpbmcgdG8gZ2V0IGRldGFpbHMgZnJvbSBwbGF5bGlzdC4iKQogICAgICAgICAgICBuPWF3YWl0IGltcG9ydF9wbGF5X2xpc3QoeXRwbGF5bGlzdCkKICAgICAgICAgICAgaWYgbm90IG46CiAgICAgICAgICAgICAgICBhd2FpdCBzdGF0dXMuZWRpdCgiRXJyb3JzIE9jY3VyZWQgd2hpbGUgaW1wb3J0aW5nIHBsYXlsaXN0LiIpCiAgICAgICAgICAgICAgICBhd2FpdCBkZWxldGVfbWVzc2FnZXMoW20sIHN0YXR1c10pCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgaWYgQ29uZmlnLlNIVUZGTEU6CiAgICAgICAgICAgICAgICBhd2FpdCBzaHVmZmxlX3BsYXlsaXN0KCkKICAgICAgICAgICAgcGw9YXdhaXQgZ2V0X3BsYXlsaXN0X3N0cigpCiAgICAgICAgICAgIGlmIG0uY2hhdC50eXBlID09ICJwcml2YXRlIjoKICAgICAgICAgICAgICAgIGF3YWl0IHN0YXR1cy5lZGl0KHBsLCBkaXNhYmxlX3dlYl9wYWdlX3ByZXZpZXc9VHJ1ZSwgcmVwbHlfbWFya3VwPWF3YWl0IGdldF9idXR0b25zKCkpICAgICAgICAKICAgICAgICAgICAgZWxpZiBub3QgQ29uZmlnLkxPR19HUk9VUCBhbmQgbS5jaGF0LnR5cGUgPT0gInN1cGVyZ3JvdXAiOgogICAgICAgICAgICAgICAgaWYgQ29uZmlnLm1zZy5nZXQoInBsYXlsaXN0IikgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgYXdhaXQgQ29uZmlnLm1zZ1sncGxheWxpc3QnXS5kZWxldGUoKQogICAgICAgICAgICAgICAgQ29uZmlnLm1zZ1sncGxheWxpc3QnXT1hd2FpdCBzdGF0dXMuZWRpdChwbCwgZGlzYWJsZV93ZWJfcGFnZV9wcmV2aWV3PVRydWUsIHJlcGx5X21hcmt1cD1hd2FpdCBnZXRfYnV0dG9ucygpKQogICAgICAgICAgICAgICAgYXdhaXQgZGVsZXRlX21lc3NhZ2VzKFttXSkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGF3YWl0IGRlbGV0ZV9tZXNzYWdlcyhbbSwgc3RhdHVzXSkKICAgICAgICBlbHNlOgogICAgICAgICAgICBrPWF3YWl0IG0ucmVwbHkoIk5vIHBsYXlMaXN0IGZpbGUgZ2l2ZW4uIFVzZSBAaVB1cmV4ICBvciBzZWFyY2ggZm9yIGEgcGxheWxpc3QgaW4gQGlQdXJleCB0byBnZXQgYSBwbGF5bGlzdCBmaWxlLiIpCiAgICAgICAgICAgIGF3YWl0IGRlbGV0ZV9tZXNzYWdlcyhbbSwga10pCgoKQENsaWVudC5vbl9tZXNzYWdlKGZpbHRlcnMuY29tbWFuZChbInN0cmVhbSIsIGYic3RyZWFtQHtDb25maWcuQk9UX1VTRVJOQU1FfSJdKSAmIGFkbWluX2ZpbHRlciAmIGNoYXRfZmlsdGVyKQphc3luYyBkZWYgc3RyZWFtKGNsaWVudCwgbTogTWVzc2FnZSk6CiAgICB3aXRoIHN1cHByZXNzKE1lc3NhZ2VJZEludmFsaWQsIE1lc3NhZ2VOb3RNb2RpZmllZCk6CiAgICAgICAgbXNnPWF3YWl0IG0ucmVwbHkoIkNoZWNraW5nIHRoZSByZWNpdmVkIGlucHV0LiIpCiAgICAgICAgaWYgbS5yZXBseV90b19tZXNzYWdlIGFuZCBtLnJlcGx5X3RvX21lc3NhZ2UudGV4dDoKICAgICAgICAgICAgbGluaz1tLnJlcGx5X3RvX21lc3NhZ2UudGV4dAogICAgICAgIGVsaWYgIiAiIGluIG0udGV4dDoKICAgICAgICAgICAgdGV4dCA9IG0udGV4dC5zcGxpdCgiICIsIDEpCiAgICAgICAgICAgIGxpbmsgPSB0ZXh0WzFdCiAgICAgICAgZWxzZToKICAgICAgICAgICAgayA9IGF3YWl0IG1zZy5lZGl0KCJQcm92aWRlIGEgbGluayB0byBzdHJlYW0hIikKICAgICAgICAgICAgYXdhaXQgZGVsZXRlX21lc3NhZ2VzKFttLCBrXSkKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgcmVnZXggPSByIl4oPzpodHRwcz86XC9cLyk/KD86d3d3XC4pP3lvdXR1XC4/YmUoPzpcLmNvbSk/XC8/LiooPzp3YXRjaHxlbWJlZCk/KD86Lip2PXx2XC98XC8pKFtcd1wtX10rKVwmPyIKICAgICAgICBtYXRjaCA9IHJlLm1hdGNoKHJlZ2V4LGxpbmspCiAgICAgICAgaWYgbWF0Y2g6CiAgICAgICAgICAgIHN0cmVhbV9saW5rPWF3YWl0IGdldF9saW5rKGxpbmspCiAgICAgICAgICAgIGlmIG5vdCBzdHJlYW1fbGluazoKICAgICAgICAgICAgICAgIGsgPSBhd2FpdCBtc2cuZWRpdCgiVGhpcyBpcyBhbiBpbnZhbGlkIGxpbmsuIikKICAgICAgICAgICAgICAgIGF3YWl0IGRlbGV0ZV9tZXNzYWdlcyhbbSwga10pCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICBlbHNlOgogICAgICAgICAgICBzdHJlYW1fbGluaz1saW5rCiAgICAgICAgdHJ5OgogICAgICAgICAgICBpc19hdWRpb18gPSBhd2FpdCBpc19hdWRpbyhzdHJlYW1fbGluaykKICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgIGlzX2F1ZGlvXyA9IEZhbHNlCiAgICAgICAgICAgIExPR0dFUi5lcnJvcigiVW5hYmxlIHRvIGdldCBBdWRpbyBwcm9wZXJ0aWVzIHdpdGhpbiB0aW1lLiIpCiAgICAgICAgaWYgbm90IGlzX2F1ZGlvXzoKICAgICAgICAgICAgayA9IGF3YWl0IG1zZy5lZGl0KCJUaGlzIGlzIGFuIGludmFsaWQgbGluaywgcHJvdmlkZSBtZSBhIGRpcmVjdCBsaW5rIG9yIGEgeW91dHViZSBsaW5rLiIpCiAgICAgICAgICAgIGF3YWl0IGRlbGV0ZV9tZXNzYWdlcyhbbSwga10pCiAgICAgICAgICAgIHJldHVybgogICAgICAgIHRyeToKICAgICAgICAgICAgZHVyPWF3YWl0IGdldF9kdXJhdGlvbihzdHJlYW1fbGluaykKICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgIGR1cj0wCiAgICAgICAgaWYgZHVyICE9IDA6CiAgICAgICAgICAgIGsgPSBhd2FpdCBtc2cuZWRpdCgiVGhpcyBpcyBub3QgYSBsaXZlIHN0cmVhbSwgVXNlIC9wbGF5IGNvbW1hbmQuIikKICAgICAgICAgICAgYXdhaXQgZGVsZXRlX21lc3NhZ2VzKFttLCBrXSkKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgaywgbXNnXz1hd2FpdCBzdHJlYW1fZnJvbV9saW5rKHN0cmVhbV9saW5rKQogICAgICAgIGlmIGsgPT0gRmFsc2U6CiAgICAgICAgICAgIGsgPSBhd2FpdCBtc2cuZWRpdChtc2dfKQogICAgICAgICAgICBhd2FpdCBkZWxldGVfbWVzc2FnZXMoW20sIGtdKQogICAgICAgICAgICByZXR1cm4KICAgICAgICBpZiBDb25maWcubXNnLmdldCgncGxheWVyJyk6CiAgICAgICAgICAgIGF3YWl0IENvbmZpZy5tc2dbJ3BsYXllciddLmRlbGV0ZSgpCiAgICAgICAgQ29uZmlnLm1zZ1sncGxheWVyJ109YXdhaXQgbXNnLmVkaXQoZiJbU3RyZWFtaW5nXSh7c3RyZWFtX2xpbmt9KSBTdGFydGVkLiDjhaTjhaTjhaTjhaTjhaTjhaTjhaTjhaTjhaTjhaTjhaTjhaTjhaTjhaTjhaTjhaTjhaTjhaTjhaTjhaTjhaTjhaTjhaTjhaQiLCBkaXNhYmxlX3dlYl9wYWdlX3ByZXZpZXc9VHJ1ZSwgcmVwbHlfbWFya3VwPWF3YWl0IGdldF9idXR0b25zKCkpCiAgICAgICAgYXdhaXQgZGVsZXRlX21lc3NhZ2VzKFttXSkKICAgICAgICAKCgphZG1pbmNtZHM9WyJ5cGxheSIsICJsZWF2ZSIsICJwYXVzZSIsICJyZXN1bWUiLCAic2tpcCIsICJyZXN0YXJ0IiwgInZvbHVtZSIsICJzaHVmZmxlIiwgImNsZWFycGxheWxpc3QiLCAiZXhwb3J0IiwgImltcG9ydCIsICJ1cGRhdGUiLCAncmVwbGF5JywgJ2xvZ3MnLCAnc3RyZWFtJywgJ2ZwbGF5JywgJ3NjaGVkdWxlJywgJ3JlY29yZCcsICdzbGlzdCcsICdjYW5jZWwnLCAnY2FuY2VsYWxsJywgJ3ZjcHJvbW90ZScsICd2Y2RlbW90ZScsICdyZWZyZXNoJywgJ3J0aXRsZScsICdzZWVrJywgJ3ZjbXV0ZScsICd1bm11dGUnLApmJ3N0cmVhbUB7Q29uZmlnLkJPVF9VU0VSTkFNRX0nLCBmJ2xvZ3NAe0NvbmZpZy5CT1RfVVNFUk5BTUV9JywgZiJyZXBsYXlAe0NvbmZpZy5CT1RfVVNFUk5BTUV9IiwgZiJ5cGxheUB7Q29uZmlnLkJPVF9VU0VSTkFNRX0iLCBmImxlYXZlQHtDb25maWcuQk9UX1VTRVJOQU1FfSIsIGYicGF1c2VAe0NvbmZpZy5CT1RfVVNFUk5BTUV9IiwgZiJyZXN1bWVAe0NvbmZpZy5CT1RfVVNFUk5BTUV9IiwgZiJza2lwQHtDb25maWcuQk9UX1VTRVJOQU1FfSIsIApmInJlc3RhcnRAe0NvbmZpZy5CT1RfVVNFUk5BTUV9IiwgZiJ2b2x1bWVAe0NvbmZpZy5CT1RfVVNFUk5BTUV9IiwgZiJzaHVmZmxlQHtDb25maWcuQk9UX1VTRVJOQU1FfSIsIGYiY2xlYXJwbGF5bGlzdEB7Q29uZmlnLkJPVF9VU0VSTkFNRX0iLCBmImV4cG9ydEB7Q29uZmlnLkJPVF9VU0VSTkFNRX0iLCBmImltcG9ydEB7Q29uZmlnLkJPVF9VU0VSTkFNRX0iLCBmInVwZGF0ZUB7Q29uZmlnLkJPVF9VU0VSTkFNRX0iLApmJ3BsYXlAe0NvbmZpZy5CT1RfVVNFUk5BTUV9JywgZidzY2hlZHVsZUB7Q29uZmlnLkJPVF9VU0VSTkFNRX0nLCBmJ3JlY29yZEB7Q29uZmlnLkJPVF9VU0VSTkFNRX0nLCBmJ3NsaXN0QHtDb25maWcuQk9UX1VTRVJOQU1FfScsIGYnY2FuY2VsQHtDb25maWcuQk9UX1VTRVJOQU1FfScsIGYnY2FuY2VsYWxsQHtDb25maWcuQk9UX1VTRVJOQU1FfScsIGYndmNwcm9tb3RlQHtDb25maWcuQk9UX1VTRVJOQU1FfScsIApmJ3ZjZGVtb3RlQHtDb25maWcuQk9UX1VTRVJOQU1FfScsIGYncmVmcmVzaEB7Q29uZmlnLkJPVF9VU0VSTkFNRX0nLCBmJ3J0aXRsZUB7Q29uZmlnLkJPVF9VU0VSTkFNRX0nLCBmJ3NlZWtAe0NvbmZpZy5CT1RfVVNFUk5BTUV9JywgZidtdXRlQHtDb25maWcuQk9UX1VTRVJOQU1FfScsIGYndmN1bm11dGVAe0NvbmZpZy5CT1RfVVNFUk5BTUV9JwpdCgphbGxjbWQgPSBbInBsYXkiLCAicGxheWVyIiwgZiJwbGF5QHtDb25maWcuQk9UX1VTRVJOQU1FfSIsIGYicGxheWVyQHtDb25maWcuQk9UX1VTRVJOQU1FfSJdICsgYWRtaW5jbWRzCgpAQ2xpZW50Lm9uX21lc3NhZ2UoZmlsdGVycy5jb21tYW5kKGFkbWluY21kcykgJiB+YWRtaW5fZmlsdGVyICYgY2hhdF9maWx0ZXIpCmFzeW5jIGRlZiBub3Rmb3J1KF8sIG06IE1lc3NhZ2UpOgogICAgayA9IGF3YWl0IF8uc2VuZF9jYWNoZWRfbWVkaWEoY2hhdF9pZD1tLmNoYXQuaWQsIGZpbGVfaWQ9IkNBQUNBZ0VBQXhrQkFBSWw5R0c3a1NONmFJTmQ2ODV2b2Z4bmlSaURCWEp6QUFJbEFnQUN0Z2VZUkViQXpkME41RlhMSXdRIiwgY2FwdGlvbj0iWW91IEFyZSBOb3QgQXV0aG9yaXplZCIsIHJlcGx5X21hcmt1cD1JbmxpbmVLZXlib2FyZE1hcmt1cChbW0lubGluZUtleWJvYXJkQnV0dG9uKCfimqHvuI/ZgtmG2KfYqSDYp9mE2LPZiNix2LMnLCB1cmw9J2h0dHBzOi8vdC5tZS9pUHVyZXgnKV1dKSkKICAgIGF3YWl0IGRlbGV0ZV9tZXNzYWdlcyhbbSwga10pCgpAQ2xpZW50Lm9uX21lc3NhZ2UoZmlsdGVycy5jb21tYW5kKGFsbGNtZCkgJiB+Y2hhdF9maWx0ZXIgJiBmaWx0ZXJzLmdyb3VwKQphc3luYyBkZWYgbm90X2NoYXQoXywgbTogTWVzc2FnZSk6CiAgICBpZiBtLmZyb21fdXNlciBpcyBub3QgTm9uZSBhbmQgbS5mcm9tX3VzZXIuaWQgaW4gQ29uZmlnLlNVRE86CiAgICAgICAgYnV0dG9ucyA9IFsKICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgSW5saW5lS2V5Ym9hcmRCdXR0b24oJ+Kaoe+4j9iq2LrZitixINmC2YbYp9ipINin2YTYqti02LrZitmEJywgY2FsbGJhY2tfZGF0YT0nc2V0X25ld19jaGF0JyksCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIElubGluZUtleWJvYXJkQnV0dG9uKCdObycsIGNhbGxiYWNrX2RhdGE9J2Nsb3Nlc3VkbycpLAogICAgICAgICAgICBdCiAgICAgICAgICAgIF0KICAgICAgICBhd2FpdCBtLnJlcGx5KCJUaGlzIGlzIG5vdCB0aGUgZ3JvdXAgd2hpY2ggaSBoYXZlIGJlZW4gY29uZmlndXJlZCB0byBwbGF5LCBEbyB5b3Ugd2FudCB0byBzZXQgdGhpcyBncm91cCBhcyBkZWZhdWx0IENIQVQ/IiwgcmVwbHlfbWFya3VwPUlubGluZUtleWJvYXJkTWFya3VwKGJ1dHRvbnMpKQogICAgICAgIGF3YWl0IGRlbGV0ZV9tZXNzYWdlcyhbbV0pCiAgICBlbHNlOgogICAgICAgIGJ1dHRvbnMgPSBbCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIElubGluZUtleWJvYXJkQnV0dG9uKCfimqHvuI/ZgtmG2KfYqSDYp9mE2KrYrdiv2YrYq9in2KonLCB1cmw9J2h0dHBzOi8vdC5tZS9NQU1PMjQ2JyksCiAgICAgICAgICAgICAgICBJbmxpbmVLZXlib2FyZEJ1dHRvbign8J+nqSDZgtmG2KfYqSDYp9mE2LPZiNix2LMnLCB1cmw9J2h0dHBzOi8vdC5tZS9pUHVyZXgnKSwKICAgICAgICAgICAgXQogICAgICAgICAgICBdCiAgICAgICAgYXdhaXQgbS5yZXBseSgiPGI+2LnYsNix2KfZiyDZhNinINmK2YXZg9mG2YMg2KfYs9iq2K7Yr9in2YUg2YfYsNinINin2YTYqNmI2KosINmC2YUg2KjZhdix2KfYs9mE2KkgW9in2YTZhdi32YjYsV0oaHR0cHM6Ly90Lm1lL0hVQ0JPVCkg2YTYpdmG2LTYp9ihINio2YjYqiDYrtin2LUg2KjZg/CfmYIuPC9iPiIsIGRpc2FibGVfd2ViX3BhZ2VfcHJldmlldz1UcnVlLCByZXBseV9tYXJrdXA9SW5saW5lS2V5Ym9hcmRNYXJrdXAoYnV0dG9ucykpCgo='))